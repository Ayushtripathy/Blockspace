{"ast":null,"code":"\"use strict\";\n\nvar _sliceInstanceProperty = require(\"@babel/runtime-corejs3/core-js-stable/instance/slice\");\n\nvar _Array$from2 = require(\"@babel/runtime-corejs3/core-js-stable/array/from\");\n\nvar _Symbol = require(\"@babel/runtime-corejs3/core-js-stable/symbol\");\n\nvar _getIteratorMethod = require(\"@babel/runtime-corejs3/core-js/get-iterator-method\");\n\nvar _Array$isArray2 = require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs3/regenerator\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/promise\"));\n\nvar _set = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/set\"));\n\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\n\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\n\nvar _includes = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/includes\"));\n\nvar _keys2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/keys\"));\n\nvar _startsWith = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/starts-with\"));\n\nvar _keys3 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/keys\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _from = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/from\"));\n\nvar _find = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/find\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/slicedToArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/asyncToGenerator\"));\n\nvar _CoreManager = _interopRequireDefault(require(\"./CoreManager\"));\n\nvar _ParseQuery = _interopRequireDefault(require(\"./ParseQuery\"));\n\nvar _LocalDatastoreUtils = require(\"./LocalDatastoreUtils\");\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof _Symbol !== \"undefined\" && _getIteratorMethod(o) || o[\"@@iterator\"];\n\n  if (!it) {\n    if (_Array$isArray2(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function () {};\n\n      return {\n        s: F,\n        n: function () {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function (_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function () {\n      it = it.call(o);\n    },\n    n: function () {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function (_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function () {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  var _context16;\n\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n\n  var n = _sliceInstanceProperty(_context16 = Object.prototype.toString.call(o)).call(_context16, 8, -1);\n\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return _Array$from2(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n/**\n * Provides a local datastore which can be used to store and retrieve <code>Parse.Object</code>. <br />\n * To enable this functionality, call <code>Parse.enableLocalDatastore()</code>.\n *\n * Pin object to add to local datastore\n *\n * <pre>await object.pin();</pre>\n * <pre>await object.pinWithName('pinName');</pre>\n *\n * Query pinned objects\n *\n * <pre>query.fromLocalDatastore();</pre>\n * <pre>query.fromPin();</pre>\n * <pre>query.fromPinWithName();</pre>\n *\n * <pre>const localObjects = await query.find();</pre>\n *\n * @class Parse.LocalDatastore\n * @static\n */\n\n\nvar LocalDatastore = {\n  isEnabled: false,\n  isSyncing: false,\n  fromPinWithName: function (name\n  /*: string*/\n  )\n  /*: Promise<Array<Object>>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.fromPinWithName(name);\n  },\n  pinWithName: function (name\n  /*: string*/\n  , value\n  /*: any*/\n  )\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.pinWithName(name, value);\n  },\n  unPinWithName: function (name\n  /*: string*/\n  )\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.unPinWithName(name);\n  },\n  _getAllContents: function ()\n  /*: Promise<Object>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getAllContents();\n  },\n  // Use for testing\n  _getRawStorage: function ()\n  /*: Promise<Object>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getRawStorage();\n  },\n  _clear: function ()\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.clear();\n  },\n  // Pin the object and children recursively\n  // Saves the object and children key to Pin Name\n  _handlePinAllWithName: function (name\n  /*: string*/\n  , objects\n  /*: Array<ParseObject>*/\n  )\n  /*: Promise<void>*/\n  {\n    var _this = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {\n      var _context;\n\n      var pinName, toPinPromises, objectKeys, _iterator, _step, parent, children, parentKey, json, objectKey, fromPinPromise, _yield$Promise$all, _yield$Promise$all2, pinned, toPin;\n\n      return _regenerator.default.wrap(function (_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              pinName = _this.getPinName(name);\n              toPinPromises = [];\n              objectKeys = [];\n              _iterator = _createForOfIteratorHelper(objects);\n\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  parent = _step.value;\n                  children = _this._getChildren(parent);\n                  parentKey = _this.getKeyForObject(parent);\n                  json = parent._toFullJSON(undefined, true);\n\n                  if (parent._localId) {\n                    json._localId = parent._localId;\n                  }\n\n                  children[parentKey] = json;\n\n                  for (objectKey in children) {\n                    objectKeys.push(objectKey);\n                    toPinPromises.push(_this.pinWithName(objectKey, [children[objectKey]]));\n                  }\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n\n              fromPinPromise = _this.fromPinWithName(pinName);\n              _context2.next = 8;\n              return _promise.default.all([fromPinPromise, toPinPromises]);\n\n            case 8:\n              _yield$Promise$all = _context2.sent;\n              _yield$Promise$all2 = (0, _slicedToArray2.default)(_yield$Promise$all, 1);\n              pinned = _yield$Promise$all2[0];\n              toPin = (0, _toConsumableArray2.default)(new _set.default((0, _concat.default)(_context = []).call(_context, (0, _toConsumableArray2.default)(pinned || []), objectKeys)));\n              return _context2.abrupt(\"return\", _this.pinWithName(pinName, toPin));\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  // Removes object and children keys from pin name\n  // Keeps the object and children pinned\n  _handleUnPinAllWithName: function (name\n  /*: string*/\n  , objects\n  /*: Array<ParseObject>*/\n  ) {\n    var _this2 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2() {\n      var localDatastore, pinName, promises, objectKeys, _iterator2, _step2, _objectKeys, _context3, parent, children, parentKey, pinned, _iterator3, _step3, objectKey, hasReference, key, pinnedObjects;\n\n      return _regenerator.default.wrap(function (_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _this2._getAllContents();\n\n            case 2:\n              localDatastore = _context4.sent;\n              pinName = _this2.getPinName(name);\n              promises = [];\n              objectKeys = [];\n              _iterator2 = _createForOfIteratorHelper(objects);\n\n              try {\n                for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                  parent = _step2.value;\n                  children = _this2._getChildren(parent);\n                  parentKey = _this2.getKeyForObject(parent);\n\n                  (_objectKeys = objectKeys).push.apply(_objectKeys, (0, _concat.default)(_context3 = [parentKey]).call(_context3, (0, _toConsumableArray2.default)((0, _keys2.default)(children))));\n                }\n              } catch (err) {\n                _iterator2.e(err);\n              } finally {\n                _iterator2.f();\n              }\n\n              objectKeys = (0, _toConsumableArray2.default)(new _set.default(objectKeys));\n              pinned = localDatastore[pinName] || [];\n              pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                return !(0, _includes.default)(objectKeys).call(objectKeys, item);\n              });\n\n              if (pinned.length === 0) {\n                promises.push(_this2.unPinWithName(pinName));\n                delete localDatastore[pinName];\n              } else {\n                promises.push(_this2.pinWithName(pinName, pinned));\n                localDatastore[pinName] = pinned;\n              }\n\n              _iterator3 = _createForOfIteratorHelper(objectKeys);\n              _context4.prev = 13;\n\n              _iterator3.s();\n\n            case 15:\n              if ((_step3 = _iterator3.n()).done) {\n                _context4.next = 31;\n                break;\n              }\n\n              objectKey = _step3.value;\n              hasReference = false;\n              _context4.t0 = (0, _keys3.default)(_regenerator.default).call(_regenerator.default, localDatastore);\n\n            case 19:\n              if ((_context4.t1 = _context4.t0()).done) {\n                _context4.next = 28;\n                break;\n              }\n\n              key = _context4.t1.value;\n\n              if (!(key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX))) {\n                _context4.next = 26;\n                break;\n              }\n\n              pinnedObjects = localDatastore[key] || [];\n\n              if (!(0, _includes.default)(pinnedObjects).call(pinnedObjects, objectKey)) {\n                _context4.next = 26;\n                break;\n              }\n\n              hasReference = true;\n              return _context4.abrupt(\"break\", 28);\n\n            case 26:\n              _context4.next = 19;\n              break;\n\n            case 28:\n              if (!hasReference) {\n                promises.push(_this2.unPinWithName(objectKey));\n              }\n\n            case 29:\n              _context4.next = 15;\n              break;\n\n            case 31:\n              _context4.next = 36;\n              break;\n\n            case 33:\n              _context4.prev = 33;\n              _context4.t2 = _context4[\"catch\"](13);\n\n              _iterator3.e(_context4.t2);\n\n            case 36:\n              _context4.prev = 36;\n\n              _iterator3.f();\n\n              return _context4.finish(36);\n\n            case 39:\n              return _context4.abrupt(\"return\", _promise.default.all(promises));\n\n            case 40:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee2, null, [[13, 33, 36, 39]]);\n    }))();\n  },\n  // Retrieve all pointer fields from object recursively\n  _getChildren: function (object\n  /*: ParseObject*/\n  ) {\n    var encountered = {};\n\n    var json = object._toFullJSON(undefined, true);\n\n    for (var key in json) {\n      if (json[key] && json[key].__type && json[key].__type === 'Object') {\n        this._traverse(json[key], encountered);\n      }\n    }\n\n    return encountered;\n  },\n  _traverse: function (object\n  /*: any*/\n  , encountered\n  /*: any*/\n  ) {\n    if (!object.objectId) {\n      return;\n    }\n\n    var objectKey = this.getKeyForObject(object);\n\n    if (encountered[objectKey]) {\n      return;\n    }\n\n    encountered[objectKey] = object;\n\n    for (var key in object) {\n      var json = object[key];\n\n      if (!object[key]) {\n        json = object;\n      }\n\n      if (json.__type && json.__type === 'Object') {\n        this._traverse(json, encountered);\n      }\n    }\n  },\n  // Transform keys in pin name to objects\n  _serializeObjectsFromPinName: function (name\n  /*: string*/\n  ) {\n    var _this3 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n      var _ref;\n\n      var localDatastore, allObjects, key, pinName, pinned, promises, objects;\n      return _regenerator.default.wrap(function (_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _this3._getAllContents();\n\n            case 2:\n              localDatastore = _context5.sent;\n              allObjects = [];\n\n              for (key in localDatastore) {\n                if ((0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  allObjects.push(localDatastore[key][0]);\n                }\n              }\n\n              if (name) {\n                _context5.next = 7;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", allObjects);\n\n            case 7:\n              pinName = _this3.getPinName(name);\n              pinned = localDatastore[pinName];\n\n              if ((0, _isArray.default)(pinned)) {\n                _context5.next = 11;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", []);\n\n            case 11:\n              promises = (0, _map.default)(pinned).call(pinned, function (objectKey) {\n                return _this3.fromPinWithName(objectKey);\n              });\n              _context5.next = 14;\n              return _promise.default.all(promises);\n\n            case 14:\n              objects = _context5.sent;\n              objects = (0, _concat.default)(_ref = []).apply(_ref, (0, _toConsumableArray2.default)(objects));\n              return _context5.abrupt(\"return\", (0, _filter.default)(objects).call(objects, function (object) {\n                return object != null;\n              }));\n\n            case 17:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee3);\n    }))();\n  },\n  // Replaces object pointers with pinned pointers\n  // The object pointers may contain old data\n  // Uses Breadth First Search Algorithm\n  _serializeObject: function (objectKey\n  /*: string*/\n  , localDatastore\n  /*: any*/\n  ) {\n    var _this4 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4() {\n      var LDS, root, queue, meta, uniqueId, nodeId, subTreeRoot, field, value, key, pointer;\n      return _regenerator.default.wrap(function (_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              LDS = localDatastore;\n\n              if (LDS) {\n                _context6.next = 5;\n                break;\n              }\n\n              _context6.next = 4;\n              return _this4._getAllContents();\n\n            case 4:\n              LDS = _context6.sent;\n\n            case 5:\n              if (!(!LDS[objectKey] || LDS[objectKey].length === 0)) {\n                _context6.next = 7;\n                break;\n              }\n\n              return _context6.abrupt(\"return\", null);\n\n            case 7:\n              root = LDS[objectKey][0];\n              queue = [];\n              meta = {};\n              uniqueId = 0;\n              meta[uniqueId] = root;\n              queue.push(uniqueId);\n\n              while (queue.length !== 0) {\n                nodeId = queue.shift();\n                subTreeRoot = meta[nodeId];\n\n                for (field in subTreeRoot) {\n                  value = subTreeRoot[field];\n\n                  if (value.__type && value.__type === 'Object') {\n                    key = _this4.getKeyForObject(value);\n\n                    if (LDS[key] && LDS[key].length > 0) {\n                      pointer = LDS[key][0];\n                      uniqueId++;\n                      meta[uniqueId] = pointer;\n                      subTreeRoot[field] = pointer;\n                      queue.push(uniqueId);\n                    }\n                  }\n                }\n              }\n\n              return _context6.abrupt(\"return\", root);\n\n            case 15:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee4);\n    }))();\n  },\n  // Called when an object is save / fetched\n  // Update object pin value\n  _updateObjectIfPinned: function (object\n  /*: ParseObject*/\n  )\n  /*: Promise<void>*/\n  {\n    var _this5 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5() {\n      var objectKey, pinned;\n      return _regenerator.default.wrap(function (_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              if (_this5.isEnabled) {\n                _context7.next = 2;\n                break;\n              }\n\n              return _context7.abrupt(\"return\");\n\n            case 2:\n              objectKey = _this5.getKeyForObject(object);\n              _context7.next = 5;\n              return _this5.fromPinWithName(objectKey);\n\n            case 5:\n              pinned = _context7.sent;\n\n              if (!(!pinned || pinned.length === 0)) {\n                _context7.next = 8;\n                break;\n              }\n\n              return _context7.abrupt(\"return\");\n\n            case 8:\n              return _context7.abrupt(\"return\", _this5.pinWithName(objectKey, [object._toFullJSON()]));\n\n            case 9:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee5);\n    }))();\n  },\n  // Called when object is destroyed\n  // Unpin object and remove all references from pin names\n  // TODO: Destroy children?\n  _destroyObjectIfPinned: function (object\n  /*: ParseObject*/\n  ) {\n    var _this6 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6() {\n      var localDatastore, objectKey, pin, promises, key, pinned;\n      return _regenerator.default.wrap(function (_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              if (_this6.isEnabled) {\n                _context8.next = 2;\n                break;\n              }\n\n              return _context8.abrupt(\"return\");\n\n            case 2:\n              _context8.next = 4;\n              return _this6._getAllContents();\n\n            case 4:\n              localDatastore = _context8.sent;\n              objectKey = _this6.getKeyForObject(object);\n              pin = localDatastore[objectKey];\n\n              if (pin) {\n                _context8.next = 9;\n                break;\n              }\n\n              return _context8.abrupt(\"return\");\n\n            case 9:\n              promises = [_this6.unPinWithName(objectKey)];\n              delete localDatastore[objectKey];\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if ((0, _includes.default)(pinned).call(pinned, objectKey)) {\n                    pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                      return item !== objectKey;\n                    });\n\n                    if (pinned.length === 0) {\n                      promises.push(_this6.unPinWithName(key));\n                      delete localDatastore[key];\n                    } else {\n                      promises.push(_this6.pinWithName(key, pinned));\n                      localDatastore[key] = pinned;\n                    }\n                  }\n                }\n              }\n\n              return _context8.abrupt(\"return\", _promise.default.all(promises));\n\n            case 13:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee6);\n    }))();\n  },\n  // Update pin and references of the unsaved object\n  _updateLocalIdForObject: function (localId\n  /*: string*/\n  , object\n  /*: ParseObject*/\n  ) {\n    var _this7 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee7() {\n      var _context9, _context10;\n\n      var localKey, objectKey, unsaved, promises, localDatastore, key, pinned;\n      return _regenerator.default.wrap(function (_context11) {\n        while (1) {\n          switch (_context11.prev = _context11.next) {\n            case 0:\n              if (_this7.isEnabled) {\n                _context11.next = 2;\n                break;\n              }\n\n              return _context11.abrupt(\"return\");\n\n            case 2:\n              localKey = (0, _concat.default)(_context9 = (0, _concat.default)(_context10 = \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX)).call(_context10, object.className, \"_\")).call(_context9, localId);\n              objectKey = _this7.getKeyForObject(object);\n              _context11.next = 6;\n              return _this7.fromPinWithName(localKey);\n\n            case 6:\n              unsaved = _context11.sent;\n\n              if (!(!unsaved || unsaved.length === 0)) {\n                _context11.next = 9;\n                break;\n              }\n\n              return _context11.abrupt(\"return\");\n\n            case 9:\n              promises = [_this7.unPinWithName(localKey), _this7.pinWithName(objectKey, unsaved)];\n              _context11.next = 12;\n              return _this7._getAllContents();\n\n            case 12:\n              localDatastore = _context11.sent;\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if ((0, _includes.default)(pinned).call(pinned, localKey)) {\n                    pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                      return item !== localKey;\n                    });\n                    pinned.push(objectKey);\n                    promises.push(_this7.pinWithName(key, pinned));\n                    localDatastore[key] = pinned;\n                  }\n                }\n              }\n\n              return _context11.abrupt(\"return\", _promise.default.all(promises));\n\n            case 15:\n            case \"end\":\n              return _context11.stop();\n          }\n        }\n      }, _callee7);\n    }))();\n  },\n\n  /**\n   * Updates Local Datastore from Server\n   *\n   * <pre>\n   * await Parse.LocalDatastore.updateFromServer();\n   * </pre>\n   *\n   * @function updateFromServer\n   * @name Parse.LocalDatastore.updateFromServer\n   * @static\n   */\n  updateFromServer: function () {\n    var _this8 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee8() {\n      var _context12;\n\n      var localDatastore, keys, key, pointersHash, _i, _keys, _key, _key$split, _key$split2, className, objectId, queryPromises, responses, objects, pinPromises;\n\n      return _regenerator.default.wrap(function (_context13) {\n        while (1) {\n          switch (_context13.prev = _context13.next) {\n            case 0:\n              if (!(!_this8.checkIfEnabled() || _this8.isSyncing)) {\n                _context13.next = 2;\n                break;\n              }\n\n              return _context13.abrupt(\"return\");\n\n            case 2:\n              _context13.next = 4;\n              return _this8._getAllContents();\n\n            case 4:\n              localDatastore = _context13.sent;\n              keys = [];\n\n              for (key in localDatastore) {\n                if ((0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  keys.push(key);\n                }\n              }\n\n              if (!(keys.length === 0)) {\n                _context13.next = 9;\n                break;\n              }\n\n              return _context13.abrupt(\"return\");\n\n            case 9:\n              _this8.isSyncing = true;\n              pointersHash = {};\n              _i = 0, _keys = keys;\n\n            case 12:\n              if (!(_i < _keys.length)) {\n                _context13.next = 23;\n                break;\n              }\n\n              _key = _keys[_i]; // Ignore the OBJECT_PREFIX\n\n              _key$split = _key.split('_'), _key$split2 = (0, _slicedToArray2.default)(_key$split, 4), className = _key$split2[2], objectId = _key$split2[3]; // User key is split into [ 'Parse', 'LDS', '', 'User', 'objectId' ]\n\n              if (_key.split('_').length === 5 && _key.split('_')[3] === 'User') {\n                className = '_User';\n                objectId = _key.split('_')[4];\n              }\n\n              if (!(0, _startsWith.default)(objectId).call(objectId, 'local')) {\n                _context13.next = 18;\n                break;\n              }\n\n              return _context13.abrupt(\"continue\", 20);\n\n            case 18:\n              if (!(className in pointersHash)) {\n                pointersHash[className] = new _set.default();\n              }\n\n              pointersHash[className].add(objectId);\n\n            case 20:\n              _i++;\n              _context13.next = 12;\n              break;\n\n            case 23:\n              queryPromises = (0, _map.default)(_context12 = (0, _keys2.default)(pointersHash)).call(_context12, function (className) {\n                var objectIds = (0, _from.default)(pointersHash[className]);\n                var query = new _ParseQuery.default(className);\n                query.limit(objectIds.length);\n\n                if (objectIds.length === 1) {\n                  query.equalTo('objectId', objectIds[0]);\n                } else {\n                  query.containedIn('objectId', objectIds);\n                }\n\n                return (0, _find.default)(query).call(query);\n              });\n              _context13.prev = 24;\n              _context13.next = 27;\n              return _promise.default.all(queryPromises);\n\n            case 27:\n              responses = _context13.sent;\n              objects = (0, _concat.default)([]).apply([], responses);\n              pinPromises = (0, _map.default)(objects).call(objects, function (object) {\n                var objectKey = _this8.getKeyForObject(object);\n\n                return _this8.pinWithName(objectKey, object._toFullJSON());\n              });\n              _context13.next = 32;\n              return _promise.default.all(pinPromises);\n\n            case 32:\n              _this8.isSyncing = false;\n              _context13.next = 39;\n              break;\n\n            case 35:\n              _context13.prev = 35;\n              _context13.t0 = _context13[\"catch\"](24); // eslint-disable-next-line no-console\n\n              console.error('Error syncing LocalDatastore: ', _context13.t0);\n              _this8.isSyncing = false;\n\n            case 39:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n      }, _callee8, null, [[24, 35]]);\n    }))();\n  },\n  getKeyForObject: function (object\n  /*: any*/\n  ) {\n    var _context14, _context15;\n\n    var objectId = object.objectId || object._getId();\n\n    return (0, _concat.default)(_context14 = (0, _concat.default)(_context15 = \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX)).call(_context15, object.className, \"_\")).call(_context14, objectId);\n  },\n  getPinName: function (pinName\n  /*: ?string*/\n  ) {\n    if (!pinName || pinName === _LocalDatastoreUtils.DEFAULT_PIN) {\n      return _LocalDatastoreUtils.DEFAULT_PIN;\n    }\n\n    return _LocalDatastoreUtils.PIN_PREFIX + pinName;\n  },\n  checkIfEnabled: function () {\n    if (!this.isEnabled) {\n      // eslint-disable-next-line no-console\n      console.error('Parse.enableLocalDatastore() must be called first');\n    }\n\n    return this.isEnabled;\n  }\n};\nmodule.exports = LocalDatastore;\n\n_CoreManager.default.setLocalDatastoreController(require('./LocalDatastoreController'));\n\n_CoreManager.default.setLocalDatastore(LocalDatastore);","map":{"version":3,"sources":["C:/Users/ASUS/Desktop/Twitter-Start/node_modules/moralis/lib/browser/LocalDatastore.js"],"names":["_sliceInstanceProperty","require","_Array$from2","_Symbol","_getIteratorMethod","_Array$isArray2","_interopRequireDefault","_regenerator","_promise","_set","_concat","_filter","_includes","_keys2","_startsWith","_keys3","_isArray","_map","_from","_find","_toConsumableArray2","_slicedToArray2","_asyncToGenerator2","_CoreManager","_ParseQuery","_LocalDatastoreUtils","_createForOfIteratorHelper","o","allowArrayLike","it","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","return","minLen","_context16","_arrayLikeToArray","Object","prototype","toString","constructor","name","test","arr","len","arr2","Array","LocalDatastore","isEnabled","isSyncing","fromPinWithName","controller","default","getLocalDatastoreController","pinWithName","unPinWithName","_getAllContents","getAllContents","_getRawStorage","getRawStorage","_clear","clear","_handlePinAllWithName","objects","_this","mark","_callee","_context","pinName","toPinPromises","objectKeys","_iterator","_step","parent","children","parentKey","json","objectKey","fromPinPromise","_yield$Promise$all","_yield$Promise$all2","pinned","toPin","wrap","_context2","prev","getPinName","_getChildren","getKeyForObject","_toFullJSON","undefined","_localId","push","all","sent","abrupt","stop","_handleUnPinAllWithName","_this2","_callee2","localDatastore","promises","_iterator2","_step2","_objectKeys","_context3","_iterator3","_step3","hasReference","key","pinnedObjects","_context4","apply","item","t0","t1","DEFAULT_PIN","PIN_PREFIX","t2","finish","object","encountered","__type","_traverse","objectId","_serializeObjectsFromPinName","_this3","_callee3","_ref","allObjects","_context5","OBJECT_PREFIX","_serializeObject","_this4","_callee4","LDS","root","queue","meta","uniqueId","nodeId","subTreeRoot","field","pointer","_context6","shift","_updateObjectIfPinned","_this5","_callee5","_context7","_destroyObjectIfPinned","_this6","_callee6","pin","_context8","_updateLocalIdForObject","localId","_this7","_callee7","_context9","_context10","localKey","unsaved","_context11","concat","className","updateFromServer","_this8","_callee8","_context12","keys","pointersHash","_i","_keys","_key","_key$split","_key$split2","queryPromises","responses","pinPromises","_context13","checkIfEnabled","split","add","objectIds","query","limit","equalTo","containedIn","console","error","_context14","_context15","_getId","module","exports","setLocalDatastoreController","setLocalDatastore"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _sliceInstanceProperty = require(\"@babel/runtime-corejs3/core-js-stable/instance/slice\");\n\nvar _Array$from2 = require(\"@babel/runtime-corejs3/core-js-stable/array/from\");\n\nvar _Symbol = require(\"@babel/runtime-corejs3/core-js-stable/symbol\");\n\nvar _getIteratorMethod = require(\"@babel/runtime-corejs3/core-js/get-iterator-method\");\n\nvar _Array$isArray2 = require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs3/regenerator\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/promise\"));\n\nvar _set = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/set\"));\n\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\n\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\n\nvar _includes = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/includes\"));\n\nvar _keys2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/keys\"));\n\nvar _startsWith = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/starts-with\"));\n\nvar _keys3 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/keys\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _from = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/from\"));\n\nvar _find = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/find\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/slicedToArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/asyncToGenerator\"));\n\nvar _CoreManager = _interopRequireDefault(require(\"./CoreManager\"));\n\nvar _ParseQuery = _interopRequireDefault(require(\"./ParseQuery\"));\n\nvar _LocalDatastoreUtils = require(\"./LocalDatastoreUtils\");\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof _Symbol !== \"undefined\" && _getIteratorMethod(o) || o[\"@@iterator\"];\n\n  if (!it) {\n    if (_Array$isArray2(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function () {};\n\n      return {\n        s: F,\n        n: function () {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function (_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function () {\n      it = it.call(o);\n    },\n    n: function () {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function (_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function () {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  var _context16;\n\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n\n  var n = _sliceInstanceProperty(_context16 = Object.prototype.toString.call(o)).call(_context16, 8, -1);\n\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return _Array$from2(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n/**\n * Provides a local datastore which can be used to store and retrieve <code>Parse.Object</code>. <br />\n * To enable this functionality, call <code>Parse.enableLocalDatastore()</code>.\n *\n * Pin object to add to local datastore\n *\n * <pre>await object.pin();</pre>\n * <pre>await object.pinWithName('pinName');</pre>\n *\n * Query pinned objects\n *\n * <pre>query.fromLocalDatastore();</pre>\n * <pre>query.fromPin();</pre>\n * <pre>query.fromPinWithName();</pre>\n *\n * <pre>const localObjects = await query.find();</pre>\n *\n * @class Parse.LocalDatastore\n * @static\n */\n\n\nvar LocalDatastore = {\n  isEnabled: false,\n  isSyncing: false,\n  fromPinWithName: function (name\n  /*: string*/\n  )\n  /*: Promise<Array<Object>>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.fromPinWithName(name);\n  },\n  pinWithName: function (name\n  /*: string*/\n  , value\n  /*: any*/\n  )\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.pinWithName(name, value);\n  },\n  unPinWithName: function (name\n  /*: string*/\n  )\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.unPinWithName(name);\n  },\n  _getAllContents: function ()\n  /*: Promise<Object>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getAllContents();\n  },\n  // Use for testing\n  _getRawStorage: function ()\n  /*: Promise<Object>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getRawStorage();\n  },\n  _clear: function ()\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.clear();\n  },\n  // Pin the object and children recursively\n  // Saves the object and children key to Pin Name\n  _handlePinAllWithName: function (name\n  /*: string*/\n  , objects\n  /*: Array<ParseObject>*/\n  )\n  /*: Promise<void>*/\n  {\n    var _this = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {\n      var _context;\n\n      var pinName, toPinPromises, objectKeys, _iterator, _step, parent, children, parentKey, json, objectKey, fromPinPromise, _yield$Promise$all, _yield$Promise$all2, pinned, toPin;\n\n      return _regenerator.default.wrap(function (_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              pinName = _this.getPinName(name);\n              toPinPromises = [];\n              objectKeys = [];\n              _iterator = _createForOfIteratorHelper(objects);\n\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  parent = _step.value;\n                  children = _this._getChildren(parent);\n                  parentKey = _this.getKeyForObject(parent);\n                  json = parent._toFullJSON(undefined, true);\n\n                  if (parent._localId) {\n                    json._localId = parent._localId;\n                  }\n\n                  children[parentKey] = json;\n\n                  for (objectKey in children) {\n                    objectKeys.push(objectKey);\n                    toPinPromises.push(_this.pinWithName(objectKey, [children[objectKey]]));\n                  }\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n\n              fromPinPromise = _this.fromPinWithName(pinName);\n              _context2.next = 8;\n              return _promise.default.all([fromPinPromise, toPinPromises]);\n\n            case 8:\n              _yield$Promise$all = _context2.sent;\n              _yield$Promise$all2 = (0, _slicedToArray2.default)(_yield$Promise$all, 1);\n              pinned = _yield$Promise$all2[0];\n              toPin = (0, _toConsumableArray2.default)(new _set.default((0, _concat.default)(_context = []).call(_context, (0, _toConsumableArray2.default)(pinned || []), objectKeys)));\n              return _context2.abrupt(\"return\", _this.pinWithName(pinName, toPin));\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  // Removes object and children keys from pin name\n  // Keeps the object and children pinned\n  _handleUnPinAllWithName: function (name\n  /*: string*/\n  , objects\n  /*: Array<ParseObject>*/\n  ) {\n    var _this2 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2() {\n      var localDatastore, pinName, promises, objectKeys, _iterator2, _step2, _objectKeys, _context3, parent, children, parentKey, pinned, _iterator3, _step3, objectKey, hasReference, key, pinnedObjects;\n\n      return _regenerator.default.wrap(function (_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _this2._getAllContents();\n\n            case 2:\n              localDatastore = _context4.sent;\n              pinName = _this2.getPinName(name);\n              promises = [];\n              objectKeys = [];\n              _iterator2 = _createForOfIteratorHelper(objects);\n\n              try {\n                for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                  parent = _step2.value;\n                  children = _this2._getChildren(parent);\n                  parentKey = _this2.getKeyForObject(parent);\n\n                  (_objectKeys = objectKeys).push.apply(_objectKeys, (0, _concat.default)(_context3 = [parentKey]).call(_context3, (0, _toConsumableArray2.default)((0, _keys2.default)(children))));\n                }\n              } catch (err) {\n                _iterator2.e(err);\n              } finally {\n                _iterator2.f();\n              }\n\n              objectKeys = (0, _toConsumableArray2.default)(new _set.default(objectKeys));\n              pinned = localDatastore[pinName] || [];\n              pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                return !(0, _includes.default)(objectKeys).call(objectKeys, item);\n              });\n\n              if (pinned.length === 0) {\n                promises.push(_this2.unPinWithName(pinName));\n                delete localDatastore[pinName];\n              } else {\n                promises.push(_this2.pinWithName(pinName, pinned));\n                localDatastore[pinName] = pinned;\n              }\n\n              _iterator3 = _createForOfIteratorHelper(objectKeys);\n              _context4.prev = 13;\n\n              _iterator3.s();\n\n            case 15:\n              if ((_step3 = _iterator3.n()).done) {\n                _context4.next = 31;\n                break;\n              }\n\n              objectKey = _step3.value;\n              hasReference = false;\n              _context4.t0 = (0, _keys3.default)(_regenerator.default).call(_regenerator.default, localDatastore);\n\n            case 19:\n              if ((_context4.t1 = _context4.t0()).done) {\n                _context4.next = 28;\n                break;\n              }\n\n              key = _context4.t1.value;\n\n              if (!(key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX))) {\n                _context4.next = 26;\n                break;\n              }\n\n              pinnedObjects = localDatastore[key] || [];\n\n              if (!(0, _includes.default)(pinnedObjects).call(pinnedObjects, objectKey)) {\n                _context4.next = 26;\n                break;\n              }\n\n              hasReference = true;\n              return _context4.abrupt(\"break\", 28);\n\n            case 26:\n              _context4.next = 19;\n              break;\n\n            case 28:\n              if (!hasReference) {\n                promises.push(_this2.unPinWithName(objectKey));\n              }\n\n            case 29:\n              _context4.next = 15;\n              break;\n\n            case 31:\n              _context4.next = 36;\n              break;\n\n            case 33:\n              _context4.prev = 33;\n              _context4.t2 = _context4[\"catch\"](13);\n\n              _iterator3.e(_context4.t2);\n\n            case 36:\n              _context4.prev = 36;\n\n              _iterator3.f();\n\n              return _context4.finish(36);\n\n            case 39:\n              return _context4.abrupt(\"return\", _promise.default.all(promises));\n\n            case 40:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee2, null, [[13, 33, 36, 39]]);\n    }))();\n  },\n  // Retrieve all pointer fields from object recursively\n  _getChildren: function (object\n  /*: ParseObject*/\n  ) {\n    var encountered = {};\n\n    var json = object._toFullJSON(undefined, true);\n\n    for (var key in json) {\n      if (json[key] && json[key].__type && json[key].__type === 'Object') {\n        this._traverse(json[key], encountered);\n      }\n    }\n\n    return encountered;\n  },\n  _traverse: function (object\n  /*: any*/\n  , encountered\n  /*: any*/\n  ) {\n    if (!object.objectId) {\n      return;\n    }\n\n    var objectKey = this.getKeyForObject(object);\n\n    if (encountered[objectKey]) {\n      return;\n    }\n\n    encountered[objectKey] = object;\n\n    for (var key in object) {\n      var json = object[key];\n\n      if (!object[key]) {\n        json = object;\n      }\n\n      if (json.__type && json.__type === 'Object') {\n        this._traverse(json, encountered);\n      }\n    }\n  },\n  // Transform keys in pin name to objects\n  _serializeObjectsFromPinName: function (name\n  /*: string*/\n  ) {\n    var _this3 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n      var _ref;\n\n      var localDatastore, allObjects, key, pinName, pinned, promises, objects;\n      return _regenerator.default.wrap(function (_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _this3._getAllContents();\n\n            case 2:\n              localDatastore = _context5.sent;\n              allObjects = [];\n\n              for (key in localDatastore) {\n                if ((0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  allObjects.push(localDatastore[key][0]);\n                }\n              }\n\n              if (name) {\n                _context5.next = 7;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", allObjects);\n\n            case 7:\n              pinName = _this3.getPinName(name);\n              pinned = localDatastore[pinName];\n\n              if ((0, _isArray.default)(pinned)) {\n                _context5.next = 11;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", []);\n\n            case 11:\n              promises = (0, _map.default)(pinned).call(pinned, function (objectKey) {\n                return _this3.fromPinWithName(objectKey);\n              });\n              _context5.next = 14;\n              return _promise.default.all(promises);\n\n            case 14:\n              objects = _context5.sent;\n              objects = (0, _concat.default)(_ref = []).apply(_ref, (0, _toConsumableArray2.default)(objects));\n              return _context5.abrupt(\"return\", (0, _filter.default)(objects).call(objects, function (object) {\n                return object != null;\n              }));\n\n            case 17:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee3);\n    }))();\n  },\n  // Replaces object pointers with pinned pointers\n  // The object pointers may contain old data\n  // Uses Breadth First Search Algorithm\n  _serializeObject: function (objectKey\n  /*: string*/\n  , localDatastore\n  /*: any*/\n  ) {\n    var _this4 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4() {\n      var LDS, root, queue, meta, uniqueId, nodeId, subTreeRoot, field, value, key, pointer;\n      return _regenerator.default.wrap(function (_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              LDS = localDatastore;\n\n              if (LDS) {\n                _context6.next = 5;\n                break;\n              }\n\n              _context6.next = 4;\n              return _this4._getAllContents();\n\n            case 4:\n              LDS = _context6.sent;\n\n            case 5:\n              if (!(!LDS[objectKey] || LDS[objectKey].length === 0)) {\n                _context6.next = 7;\n                break;\n              }\n\n              return _context6.abrupt(\"return\", null);\n\n            case 7:\n              root = LDS[objectKey][0];\n              queue = [];\n              meta = {};\n              uniqueId = 0;\n              meta[uniqueId] = root;\n              queue.push(uniqueId);\n\n              while (queue.length !== 0) {\n                nodeId = queue.shift();\n                subTreeRoot = meta[nodeId];\n\n                for (field in subTreeRoot) {\n                  value = subTreeRoot[field];\n\n                  if (value.__type && value.__type === 'Object') {\n                    key = _this4.getKeyForObject(value);\n\n                    if (LDS[key] && LDS[key].length > 0) {\n                      pointer = LDS[key][0];\n                      uniqueId++;\n                      meta[uniqueId] = pointer;\n                      subTreeRoot[field] = pointer;\n                      queue.push(uniqueId);\n                    }\n                  }\n                }\n              }\n\n              return _context6.abrupt(\"return\", root);\n\n            case 15:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee4);\n    }))();\n  },\n  // Called when an object is save / fetched\n  // Update object pin value\n  _updateObjectIfPinned: function (object\n  /*: ParseObject*/\n  )\n  /*: Promise<void>*/\n  {\n    var _this5 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5() {\n      var objectKey, pinned;\n      return _regenerator.default.wrap(function (_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              if (_this5.isEnabled) {\n                _context7.next = 2;\n                break;\n              }\n\n              return _context7.abrupt(\"return\");\n\n            case 2:\n              objectKey = _this5.getKeyForObject(object);\n              _context7.next = 5;\n              return _this5.fromPinWithName(objectKey);\n\n            case 5:\n              pinned = _context7.sent;\n\n              if (!(!pinned || pinned.length === 0)) {\n                _context7.next = 8;\n                break;\n              }\n\n              return _context7.abrupt(\"return\");\n\n            case 8:\n              return _context7.abrupt(\"return\", _this5.pinWithName(objectKey, [object._toFullJSON()]));\n\n            case 9:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee5);\n    }))();\n  },\n  // Called when object is destroyed\n  // Unpin object and remove all references from pin names\n  // TODO: Destroy children?\n  _destroyObjectIfPinned: function (object\n  /*: ParseObject*/\n  ) {\n    var _this6 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6() {\n      var localDatastore, objectKey, pin, promises, key, pinned;\n      return _regenerator.default.wrap(function (_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              if (_this6.isEnabled) {\n                _context8.next = 2;\n                break;\n              }\n\n              return _context8.abrupt(\"return\");\n\n            case 2:\n              _context8.next = 4;\n              return _this6._getAllContents();\n\n            case 4:\n              localDatastore = _context8.sent;\n              objectKey = _this6.getKeyForObject(object);\n              pin = localDatastore[objectKey];\n\n              if (pin) {\n                _context8.next = 9;\n                break;\n              }\n\n              return _context8.abrupt(\"return\");\n\n            case 9:\n              promises = [_this6.unPinWithName(objectKey)];\n              delete localDatastore[objectKey];\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if ((0, _includes.default)(pinned).call(pinned, objectKey)) {\n                    pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                      return item !== objectKey;\n                    });\n\n                    if (pinned.length === 0) {\n                      promises.push(_this6.unPinWithName(key));\n                      delete localDatastore[key];\n                    } else {\n                      promises.push(_this6.pinWithName(key, pinned));\n                      localDatastore[key] = pinned;\n                    }\n                  }\n                }\n              }\n\n              return _context8.abrupt(\"return\", _promise.default.all(promises));\n\n            case 13:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee6);\n    }))();\n  },\n  // Update pin and references of the unsaved object\n  _updateLocalIdForObject: function (localId\n  /*: string*/\n  , object\n  /*: ParseObject*/\n  ) {\n    var _this7 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee7() {\n      var _context9, _context10;\n\n      var localKey, objectKey, unsaved, promises, localDatastore, key, pinned;\n      return _regenerator.default.wrap(function (_context11) {\n        while (1) {\n          switch (_context11.prev = _context11.next) {\n            case 0:\n              if (_this7.isEnabled) {\n                _context11.next = 2;\n                break;\n              }\n\n              return _context11.abrupt(\"return\");\n\n            case 2:\n              localKey = (0, _concat.default)(_context9 = (0, _concat.default)(_context10 = \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX)).call(_context10, object.className, \"_\")).call(_context9, localId);\n              objectKey = _this7.getKeyForObject(object);\n              _context11.next = 6;\n              return _this7.fromPinWithName(localKey);\n\n            case 6:\n              unsaved = _context11.sent;\n\n              if (!(!unsaved || unsaved.length === 0)) {\n                _context11.next = 9;\n                break;\n              }\n\n              return _context11.abrupt(\"return\");\n\n            case 9:\n              promises = [_this7.unPinWithName(localKey), _this7.pinWithName(objectKey, unsaved)];\n              _context11.next = 12;\n              return _this7._getAllContents();\n\n            case 12:\n              localDatastore = _context11.sent;\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if ((0, _includes.default)(pinned).call(pinned, localKey)) {\n                    pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                      return item !== localKey;\n                    });\n                    pinned.push(objectKey);\n                    promises.push(_this7.pinWithName(key, pinned));\n                    localDatastore[key] = pinned;\n                  }\n                }\n              }\n\n              return _context11.abrupt(\"return\", _promise.default.all(promises));\n\n            case 15:\n            case \"end\":\n              return _context11.stop();\n          }\n        }\n      }, _callee7);\n    }))();\n  },\n\n  /**\n   * Updates Local Datastore from Server\n   *\n   * <pre>\n   * await Parse.LocalDatastore.updateFromServer();\n   * </pre>\n   *\n   * @function updateFromServer\n   * @name Parse.LocalDatastore.updateFromServer\n   * @static\n   */\n  updateFromServer: function () {\n    var _this8 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee8() {\n      var _context12;\n\n      var localDatastore, keys, key, pointersHash, _i, _keys, _key, _key$split, _key$split2, className, objectId, queryPromises, responses, objects, pinPromises;\n\n      return _regenerator.default.wrap(function (_context13) {\n        while (1) {\n          switch (_context13.prev = _context13.next) {\n            case 0:\n              if (!(!_this8.checkIfEnabled() || _this8.isSyncing)) {\n                _context13.next = 2;\n                break;\n              }\n\n              return _context13.abrupt(\"return\");\n\n            case 2:\n              _context13.next = 4;\n              return _this8._getAllContents();\n\n            case 4:\n              localDatastore = _context13.sent;\n              keys = [];\n\n              for (key in localDatastore) {\n                if ((0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  keys.push(key);\n                }\n              }\n\n              if (!(keys.length === 0)) {\n                _context13.next = 9;\n                break;\n              }\n\n              return _context13.abrupt(\"return\");\n\n            case 9:\n              _this8.isSyncing = true;\n              pointersHash = {};\n              _i = 0, _keys = keys;\n\n            case 12:\n              if (!(_i < _keys.length)) {\n                _context13.next = 23;\n                break;\n              }\n\n              _key = _keys[_i]; // Ignore the OBJECT_PREFIX\n\n              _key$split = _key.split('_'), _key$split2 = (0, _slicedToArray2.default)(_key$split, 4), className = _key$split2[2], objectId = _key$split2[3]; // User key is split into [ 'Parse', 'LDS', '', 'User', 'objectId' ]\n\n              if (_key.split('_').length === 5 && _key.split('_')[3] === 'User') {\n                className = '_User';\n                objectId = _key.split('_')[4];\n              }\n\n              if (!(0, _startsWith.default)(objectId).call(objectId, 'local')) {\n                _context13.next = 18;\n                break;\n              }\n\n              return _context13.abrupt(\"continue\", 20);\n\n            case 18:\n              if (!(className in pointersHash)) {\n                pointersHash[className] = new _set.default();\n              }\n\n              pointersHash[className].add(objectId);\n\n            case 20:\n              _i++;\n              _context13.next = 12;\n              break;\n\n            case 23:\n              queryPromises = (0, _map.default)(_context12 = (0, _keys2.default)(pointersHash)).call(_context12, function (className) {\n                var objectIds = (0, _from.default)(pointersHash[className]);\n                var query = new _ParseQuery.default(className);\n                query.limit(objectIds.length);\n\n                if (objectIds.length === 1) {\n                  query.equalTo('objectId', objectIds[0]);\n                } else {\n                  query.containedIn('objectId', objectIds);\n                }\n\n                return (0, _find.default)(query).call(query);\n              });\n              _context13.prev = 24;\n              _context13.next = 27;\n              return _promise.default.all(queryPromises);\n\n            case 27:\n              responses = _context13.sent;\n              objects = (0, _concat.default)([]).apply([], responses);\n              pinPromises = (0, _map.default)(objects).call(objects, function (object) {\n                var objectKey = _this8.getKeyForObject(object);\n\n                return _this8.pinWithName(objectKey, object._toFullJSON());\n              });\n              _context13.next = 32;\n              return _promise.default.all(pinPromises);\n\n            case 32:\n              _this8.isSyncing = false;\n              _context13.next = 39;\n              break;\n\n            case 35:\n              _context13.prev = 35;\n              _context13.t0 = _context13[\"catch\"](24); // eslint-disable-next-line no-console\n\n              console.error('Error syncing LocalDatastore: ', _context13.t0);\n              _this8.isSyncing = false;\n\n            case 39:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n      }, _callee8, null, [[24, 35]]);\n    }))();\n  },\n  getKeyForObject: function (object\n  /*: any*/\n  ) {\n    var _context14, _context15;\n\n    var objectId = object.objectId || object._getId();\n\n    return (0, _concat.default)(_context14 = (0, _concat.default)(_context15 = \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX)).call(_context15, object.className, \"_\")).call(_context14, objectId);\n  },\n  getPinName: function (pinName\n  /*: ?string*/\n  ) {\n    if (!pinName || pinName === _LocalDatastoreUtils.DEFAULT_PIN) {\n      return _LocalDatastoreUtils.DEFAULT_PIN;\n    }\n\n    return _LocalDatastoreUtils.PIN_PREFIX + pinName;\n  },\n  checkIfEnabled: function () {\n    if (!this.isEnabled) {\n      // eslint-disable-next-line no-console\n      console.error('Parse.enableLocalDatastore() must be called first');\n    }\n\n    return this.isEnabled;\n  }\n};\nmodule.exports = LocalDatastore;\n\n_CoreManager.default.setLocalDatastoreController(require('./LocalDatastoreController'));\n\n_CoreManager.default.setLocalDatastore(LocalDatastore);"]},"metadata":{},"sourceType":"script"}